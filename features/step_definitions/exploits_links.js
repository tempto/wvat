const assert = require("assert");
const { Given, When, Then } = require("cucumber");
const run_tool = require("../run_tool");

Given("the CVE {string}", (cve) => {
    this.cve = cve;
});

When("the user invokes the tool's exploits command", async () => {
    this.exploits = await run_tool(`exploits ${this.cve}`);
});

Then("the user is informed with the exploits databases links for the given CVE", () => {
    const exploitsLinks = this.exploits.match(/"(.*)"/g);

    assert.equal(exploitsLinks[0], `"https://www.exploit-db.com/search?cve=${this.cve}"`);
    assert.equal(exploitsLinks[1], `"https://www.rapid7.com/db/?q=CVE-${this.cve}&type=nexpose"`);
    assert.equal(exploitsLinks[2], `"https://search.circl.lu/?q=${this.cve}"`);
});
