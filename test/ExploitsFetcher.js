const { getCVEExploitsUrl, getCVEListExploitsUrls } = require("../src/ExploitsFetcher");

describe("Exploits Fetcher tests", () => {
    describe("Exploits list url for a given cve", () => {
        it("should build the exploits website url", () => {
            const cve = "2019-1017";
            expect(getCVEExploitsUrl(cve)).toEqual(
                `https://www.exploit-db.com/search?cve=${cve}`,
            );
        });

        it("should fail when the cve is missing", () => {
            expect(() => getCVEExploitsUrl()).toThrowError(new Error("Missing cve"));
        });
    });

    describe("Exploits list url for a cve list", () => {
        it("should build the exploits website url for each cve from the cve list", () => {
            const cve_list = [
                "2017-1015",
                "2018-1017",
                "2019-1019",
            ];

            expect(getCVEListExploitsUrls(cve_list)).toEqual([
                {
                    cve: cve_list[0],
                    url: `https://www.exploit-db.com/search?cve=${cve_list[0]}`,
                },
                {
                    cve: cve_list[1],
                    url: `https://www.exploit-db.com/search?cve=${cve_list[1]}`,
                },
                {
                    cve: cve_list[2],
                    url: `https://www.exploit-db.com/search?cve=${cve_list[2]}`,
                },
            ]);
        });

        it("should fail when the cve list is missing", () => {
            expect(() => getCVEListExploitsUrls()).toThrowError(new Error("Missing cve list"));
        });
    });
});
