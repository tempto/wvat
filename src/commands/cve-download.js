const Command = require("../BaseCommand");
const { downloadCVEList, parseCVEsFile, storeCVEsFile } = require("../CVEListFetcher");

class CveDownloadCommand extends Command {
    run() {
        this.log("Downloading CVE list...");
        downloadCVEList()
            .then(({ status, data }) => {
                if (status !== 200) {
                    throw new Error("Bad response");
                }

                this.log(`Finished 'download'. Got ${data.length} items`);

                const { date, version, entries } = parseCVEsFile(data);
                this.log(`Date: ${date}`);
                this.log(`Version: ${version}`);
                storeCVEsFile(entries, date, version);
                this.log("\nDone");
            })
            .catch((err) => this.error(err));
    }
}

CveDownloadCommand.description = "(TEMPORARY COMMAND) Download the CVE list file";

module.exports = CveDownloadCommand;
