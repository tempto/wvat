const Command = require("../BaseCommand");
const { downloadCVEsFile, parseCVEsFile, storeCVEsFile } = require("../CVEs");

class CveDownloadCommand extends Command {
    async run() {
        this.log("Downloading CVE list...");

        const { status, data } = await downloadCVEsFile();

        const { date, version, entries } = parseCVEsFile(data);

        this.log("Donwload Done.");

        if (status !== 200) {
            throw new Error("Bad response");
        }

        this.log("Starting to store file ...");

        storeCVEsFile(entries, date, version);

        this.log("Done.");
    }
}

CveDownloadCommand.description = "(TEMPORARY COMMAND) Download the CVE list file";

module.exports = CveDownloadCommand;
