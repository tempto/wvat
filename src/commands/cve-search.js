const Command = require("../BaseCommand");
const { searchCVEsInLocalFile } = require("../CVEListFetcher");
const { buildRegexFromSearchQuery } = require("../utils");

class CveSearchCommand extends Command {
    run() {
        const { args } = this.parse(CveSearchCommand);

        const search_query_regex = buildRegexFromSearchQuery(args.search_query);

        this.log("Starting Search ...");

        searchCVEsInLocalFile(search_query_regex, (err, result) => {
            if (err) throw new Error("Failed to search CVEs in local file");
            this.log(`Number of CVE found: ${result.length}`);
        });
    }
}

CveSearchCommand.description = "(TEMPORARY COMMAND) Search for CVEs in the local CVE file";

CveSearchCommand.args = [
    {
        name: "search_query",
        required: true,
        description: "Search query to search for CVEs",
        hidden: false,
    },
];

module.exports = CveSearchCommand;
